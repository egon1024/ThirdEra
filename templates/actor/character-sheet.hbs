<form class="{{cssClass}} flexcol" autocomplete="off">
  {{!-- Sheet Header --}}
  <header class="sheet-header sheet-header--character">
    <img class="profile-img" src="{{actor.img}}" data-edit="img" title="{{actor.name}}" height="100" width="100" />
    <div class="header-fields">
      <div class="charname-row">
        <h1 class="charname"><input name="name" type="text" value="{{actor.name}}" placeholder="Character Name" /></h1>
        <span class="actor-type-badge badge--character">PC</span>
      </div>
      <div class="resources grid grid-3col">
        <div class="resource flex-group-center">
          <label for="system.details.race" class="resource-label">Race</label>
          <input type="text" name="system.details.race" value="{{system.details.race}}" data-dtype="String" />
        </div>
        <div class="resource flex-group-center">
          <label for="system.details.class" class="resource-label">Class</label>
          <input type="text" name="system.details.class" value="{{system.details.class}}" data-dtype="String" />
        </div>
        <div class="resource flex-group-center">
          <label for="system.details.level" class="resource-label">Level</label>
          <input type="text" name="system.details.level" value="{{system.details.level}}" data-dtype="Number" />
        </div>
      </div>
    </div>
  </header>

  {{!-- Sheet Tab Navigation --}}
  <nav class="sheet-tabs tabs" data-group="primary">
    <a class="item {{#if (eq tabs.primary 'description')}}active{{/if}}" data-action="changeTab" data-group="primary"
      data-tab="description">Description</a>
    <a class="item {{#if (eq tabs.primary 'abilities')}}active{{/if}}" data-action="changeTab" data-group="primary"
      data-tab="abilities">Abilities</a>
    <a class="item {{#if (eq tabs.primary 'items')}}active{{/if}}" data-action="changeTab" data-group="primary"
      data-tab="items">Equipment</a>
    <a class="item {{#if (eq tabs.primary 'spells')}}active{{/if}}" data-action="changeTab" data-group="primary"
      data-tab="spells">Spells</a>
  </nav>

  {{!-- Sheet Body --}}
  <section class="sheet-body">

    {{!-- Description Tab --}}
    <div class="tab {{#if (eq tabs.primary 'description')}}active{{/if}}" data-group="primary" data-tab="description">
      <prose-mirror name="system.biography" data-document-u-u-i-d="{{actor.uuid}}" value="{{system.biography}}"
        toggled="false">
        {{{enriched.biography}}}
      </prose-mirror>
    </div>

    {{!-- Abilities Tab --}}
    <div class="tab abilities {{#if (eq tabs.primary 'abilities')}}active{{/if}}" data-group="primary"
      data-tab="abilities">
      {{!-- Ability Scores --}}
      <div class="abilities-header">
        <h3 class="items-header">Ability Scores</h3>
      </div>
      <ol class="abilities-list">
        {{#each system.abilities as |ability key|}}
        <li class="ability flexrow">
          <h4 class="ability-name">{{lookup @root.abilityScores key}}</h4>
          <input type="text" name="system.abilities.{{key}}.value" value="{{ability.value}}" data-dtype="Number"
            placeholder="10" />
          <span class="ability-mod {{#if (eq key 'dex')}}{{#if @root.dexCap.isCapped}}dex-capped{{/if}}{{/if}}">{{signedNumber ability.mod}}{{#if (eq key 'dex')}}{{#if @root.dexCap.isCapped}} <span class="dex-cap-note" title="Uncapped: {{signedNumber @root.dexCap.uncappedMod}} â€” limited by armor">(max)</span>{{/if}}{{/if}}</span>
          <a class="ability-check" data-action="abilityCheck" data-ability="{{key}}">
            <i class="fas fa-dice-d20"></i>
          </a>
        </li>
        {{/each}}
      </ol>

      {{!-- Combat Stats --}}
      <div class="combat-stats">
        <div class="stat-block">
          <label>HP</label>
          <div class="stat-value">
            <input type="text" name="system.attributes.hp.value" value="{{system.attributes.hp.value}}"
              data-dtype="Number" />
            <span>/</span>
            <input type="text" name="system.attributes.hp.max" value="{{system.attributes.hp.max}}"
              data-dtype="Number" />
          </div>
        </div>
        <div class="stat-block">
          <label>Initiative</label>
          <div class="stat-value">
            {{signedNumber system.attributes.initiative.bonus}}
          </div>
        </div>
        <div class="stat-block">
          <label>BAB</label>
          <div class="stat-value">
            <input type="text" name="system.combat.bab" value="{{system.combat.bab}}" data-dtype="Number" />
          </div>
        </div>
      </div>

      {{!-- AC Breakdown --}}
      <div class="ac-section">
        <div class="ac-totals">
          <div class="ac-total">
            <label>AC</label>
            <span class="ac-value">{{system.attributes.ac.value}}</span>
          </div>
          <div class="ac-total">
            <label>Touch</label>
            <span class="ac-value">{{system.attributes.ac.touch}}</span>
          </div>
          <div class="ac-total">
            <label>Flat-Footed</label>
            <span class="ac-value">{{system.attributes.ac.flatFooted}}</span>
          </div>
        </div>
        <ul class="ac-breakdown">
          <li>
            <span class="ac-breakdown-label">Base</span>
            <span class="ac-breakdown-value">10</span>
          </li>
          {{#each system.attributes.ac.breakdown as |entry|}}
          <li>
            <span class="ac-breakdown-label">{{entry.label}}</span>
            <span class="ac-breakdown-value">{{signedNumber entry.value}}</span>
          </li>
          {{/each}}
          <li>
            <span class="ac-breakdown-label">Misc</span>
            <input type="text" name="system.attributes.ac.misc" value="{{system.attributes.ac.misc}}"
              data-dtype="Number" class="ac-misc-input" />
          </li>
        </ul>
      </div>

      {{!-- Saving Throws --}}
      <div class="saves-header">
        <h3 class="items-header">Saving Throws</h3>
      </div>
      <ol class="saves-list">
        {{#each system.saves as |save key|}}
        <li class="save flexrow">
          <h4 class="save-name">{{lookup @root.saves key}}</h4>
          <input type="text" name="system.saves.{{key}}.base" value="{{save.base}}" data-dtype="Number"
            placeholder="0" />
          <span class="save-total">{{signedNumber save.total}}</span>
          <a class="save-roll" data-action="saveRoll" data-save="{{key}}">
            <i class="fas fa-dice-d20"></i>
          </a>
        </li>
        {{/each}}
      </ol>

      {{!-- Skills --}}
      <div class="skills-header">
        <h3 class="items-header">Skills</h3>
      </div>
      <ol class="items-list">
        {{#each skills as |item id|}}
        <li class="item flexrow" data-item-id="{{item._id}}">
          <div class="item-name">
            <div class="item-image"><img src="{{item.img}}" title="{{item.name}}" width="24" height="24" /></div>
            <h4>{{item.name}}</h4>
          </div>
          <div class="item-controls">
            <input type="text" name="system.ranks" value="{{item.system.ranks}}" data-dtype="Number" placeholder="0" />
            <span class="skill-total">{{signedNumber item.system.modifier.total}}</span>
            <a class="skill-check" data-action="skillCheck" title="Roll Skill"><i class="fas fa-dice-d20"></i></a>
            <a class="item-edit" data-action="editItem" title="Edit Item"><i class="fas fa-edit"></i></a>
            <a class="item-delete" data-action="deleteItem" title="Delete Item"><i class="fas fa-trash"></i></a>
          </div>
        </li>
        {{/each}}
      </ol>

      {{!-- Feats --}}
      <div class="feats-header">
        <h3 class="items-header">Feats</h3>
      </div>
      <ol class="items-list">
        {{#each feats as |item id|}}
        <li class="item flexrow" data-item-id="{{item._id}}">
          <div class="item-name">
            <div class="item-image"><img src="{{item.img}}" title="{{item.name}}" width="24" height="24" /></div>
            <h4>{{item.name}}</h4>
          </div>
          <div class="item-controls">
            <a class="item-edit" data-action="editItem" title="Edit Item"><i class="fas fa-edit"></i></a>
            <a class="item-delete" data-action="deleteItem" title="Delete Item"><i class="fas fa-trash"></i></a>
          </div>
        </li>
        {{/each}}
      </ol>
    </div>

    {{!-- Items Tab --}}
    <div class="tab items {{#if (eq tabs.primary 'items')}}active{{/if}}" data-group="primary" data-tab="items">
      {{!-- Weapons --}}
      <div class="items-header">
        <h3 class="items-header">Weapons</h3>
        <a class="item-create" data-action="createItem" data-type="weapon"><i class="fas fa-plus"></i> Add Weapon</a>
      </div>
      <ol class="items-list">
        {{#each weapons as |item id|}}
        <li class="item flexrow" data-item-id="{{item._id}}">
          <div class="item-name">
            <div class="item-image"><img src="{{item.img}}" title="{{item.name}}" width="24" height="24" /></div>
            <h4>{{item.name}}</h4>
          </div>
          <div class="item-controls">
            <span class="item-detail">{{item.system.damage.dice}}</span>
            <a class="weapon-attack" data-action="weaponAttack" title="Attack"><i class="fas fa-dice-d20"></i></a>
            <a class="weapon-damage" data-action="weaponDamage" title="Damage"><i class="fas fa-dice-d6"></i></a>
            <a class="item-edit" data-action="editItem" title="Edit Item"><i class="fas fa-edit"></i></a>
            <a class="item-delete" data-action="deleteItem" title="Delete Item"><i class="fas fa-trash"></i></a>
          </div>
        </li>
        {{/each}}
      </ol>

      {{!-- Armor --}}
      <div class="items-header">
        <h3 class="items-header">Armor</h3>
        <a class="item-create" data-action="createItem" data-type="armor"><i class="fas fa-plus"></i> Add Armor</a>
      </div>
      <ol class="items-list">
        {{#each armor as |item id|}}
        <li class="item flexrow {{#if (eq item.system.equipped 'true')}}equipped{{/if}}" data-item-id="{{item._id}}">
          <div class="item-name">
            <div class="item-image"><img src="{{item.img}}" title="{{item.name}}" width="24" height="24" /></div>
            <h4>{{item.name}}</h4>
          </div>
          <div class="item-controls">
            <span class="item-detail">AC +{{item.system.armor.bonus}}</span>
            <a class="item-equip {{#if (eq item.system.equipped 'true')}}equipped{{else}}unequipped{{/if}}" data-action="toggleEquip" title="Toggle Equipped">
              <i class="{{#if (eq item.system.equipped 'true')}}fas fa-check-circle{{else}}far fa-circle{{/if}}"></i>
            </a>
            <a class="item-edit" data-action="editItem" title="Edit Item"><i class="fas fa-edit"></i></a>
            <a class="item-delete" data-action="deleteItem" title="Delete Item"><i class="fas fa-trash"></i></a>
          </div>
        </li>
        {{/each}}
      </ol>

      {{!-- Equipment --}}
      <div class="items-header">
        <h3 class="items-header">Equipment</h3>
        <a class="item-create" data-action="createItem" data-type="equipment"><i class="fas fa-plus"></i> Add
          Equipment</a>
      </div>
      <ol class="items-list">
        {{#each equipment as |item id|}}
        <li class="item flexrow" data-item-id="{{item._id}}">
          <div class="item-name">
            <div class="item-image"><img src="{{item.img}}" title="{{item.name}}" width="24" height="24" /></div>
            <h4>{{item.name}}</h4>
          </div>
          <div class="item-controls">
            <span class="item-detail">Qty: {{item.system.quantity}}</span>
            <a class="item-edit" data-action="editItem" title="Edit Item"><i class="fas fa-edit"></i></a>
            <a class="item-delete" data-action="deleteItem" title="Delete Item"><i class="fas fa-trash"></i></a>
          </div>
        </li>
        {{/each}}
      </ol>
    </div>

    {{!-- Spells Tab --}}
    <div class="tab spells {{#if (eq tabs.primary 'spells')}}active{{/if}}" data-group="primary" data-tab="spells">
      <div class="items-header">
        <h3 class="items-header">Spells</h3>
        <a class="item-create" data-action="createItem" data-type="spell"><i class="fas fa-plus"></i> Add Spell</a>
      </div>
      <ol class="items-list">
        {{#each spells as |item id|}}
        <li class="item flexrow" data-item-id="{{item._id}}">
          <div class="item-name">
            <div class="item-image"><img src="{{item.img}}" title="{{item.name}}" width="24" height="24" /></div>
            <h4>{{item.name}}</h4>
          </div>
          <div class="item-controls">
            <span class="item-detail">Level {{item.system.level}}</span>
            <a class="item-edit" data-action="editItem" title="Edit Item"><i class="fas fa-edit"></i></a>
            <a class="item-delete" data-action="deleteItem" title="Delete Item"><i class="fas fa-trash"></i></a>
          </div>
        </li>
        {{/each}}
      </ol>
    </div>

  </section>
</form>